<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>每日习惯打卡</title><link rel='manifest' href='manifest.webmanifest'><link rel='apple-touch-icon' href='icons/icon-192.png'><script src='https://cdn.tailwindcss.com'></script></head><body><div id='root'></div><script src='https://unpkg.com/react@18/umd/react.production.min.js'></script><script src='https://unpkg.com/react-dom@18/umd/react-dom.production.min.js'></script><script src='https://unpkg.com/@babel/standalone/babel.min.js'></script><script type='text/babel'>
const {useEffect,useMemo,useRef,useState} = React;
// Minimal functional first version
function HabitTracker(){
  const defaultConfig={targets:{wake:{by:"06:00"},bed:{by:"22:00"},listening:{minutes:60},readingVocab:{minutes:30},english:{minutes:30},strength:{minutes:40},cardio:{minutes:30},eatHealthy:{required:true}},reminders:{wake:"06:00",listening:"09:00",readingVocab:"10:30",english:"15:00",strength:"17:30",cardio:"18:30",windDown:"21:30",bed:"22:00"}};
  const STORAGE_KEYS={config:"habit_config_v1",progress:(dk)=>`habit_progress_${dk}`,streak:"habit_streak_v1"};
  const todayKey=useMemo(()=>new Date().toISOString().slice(0,10),[]);
  function loadConfig(){try{const raw=localStorage.getItem(STORAGE_KEYS.config);return raw?JSON.parse(raw):structuredClone(defaultConfig);}catch{return structuredClone(defaultConfig);}}
  function saveConfig(n){localStorage.setItem(STORAGE_KEYS.config,JSON.stringify(n));}
  function loadProgress(k){try{const raw=localStorage.getItem(STORAGE_KEYS.progress(k));if(raw) return JSON.parse(raw);}catch{}return{wake:null,bed:null,listening:0,readingVocab:0,english:0,strength:0,cardio:0,eatHealthy:false,notes:"",completedAt:null};}
  function saveProgress(k,d){localStorage.setItem(STORAGE_KEYS.progress(k),JSON.stringify(d));}
  function loadStreak(){try{const raw=localStorage.getItem(STORAGE_KEYS.streak);return raw?JSON.parse(raw):{best:0,current:0,lastDate:null};}catch{return {best:0,current:0,lastDate:null};}}
  function saveStreak(d){localStorage.setItem(STORAGE_KEYS.streak,JSON.stringify(d));}
  const [config,setConfig]=useState(loadConfig);const [progress,setProgress]=useState(()=>loadProgress(todayKey));const [streak,setStreak]=useState(loadStreak);const [notifEnabled,setNotifEnabled]=useState(null);const [activeTimer,setActiveTimer]=useState(null);
  const tickRef=useRef(null);
  function toHM(date){return date.toTimeString().slice(0,5);}function parseHM(hm){const [h,m]=hm.split(":").map(Number);const d=new Date();d.setHours(h,m,0,0);return d;}
  function goalMet(p){const t=config.targets;const wakeOk=p.wake && parseHM(p.wake)<=parseHM(t.wake.by);const bedOk=p.bed && parseHM(p.bed)<=parseHM(t.bed.by);return wakeOk&&bedOk&&p.listening>=t.listening.minutes&&p.readingVocab>=t.readingVocab.minutes&&p.english>=t.english.minutes&&p.strength>=t.strength.minutes&&p.cardio>=t.cardio.minutes&&(!t.eatHealthy.required||p.eatHealthy===true);}
  function notify(title, body){ if(!('Notification' in window)) return; if(Notification.permission==='granted'){ new Notification(title,{body}); } }
  useEffect(()=>{ if('Notification' in window){ setNotifEnabled(Notification.permission==='granted'); } else { setNotifEnabled(false);} },[]);
  useEffect(()=>{ saveConfig(config); },[config]);
  useEffect(()=>{ saveProgress(todayKey,progress); },[progress,todayKey]);
  useEffect(()=>{ tickRef.current=setInterval(()=>setProgress(p=>({...p})),60000); return ()=>clearInterval(tickRef.current); },[]);
  function handleStartTimer(key){ if(activeTimer&&activeTimer.key!==key) return; setActiveTimer({key, startedAt:Date.now()});}
  function handleStopTimer(){ if(!activeTimer) return; const elapsed=Math.round((Date.now()-activeTimer.startedAt)/60000); const key=activeTimer.key; setProgress(p=>({...p,[key]:Math.max(0,(p[key]||0)+elapsed)})); setActiveTimer(null);}
  function add(key,m){ setProgress(p=>({...p,[key]:Math.max(0,(p[key]||0)+m)})); }
  return (<div className="p-4 max-w-3xl mx-auto">
    <h1 className="text-2xl font-bold mb-3">每日习惯打卡</h1>
    <div className="grid grid-cols-2 gap-3 mb-3">
      <div className="p-4 bg-white rounded-xl shadow"><div className="flex justify-between"><div><div className="font-semibold">起床（≤ {config.targets.wake.by}）</div><div className="text-sm opacity-70">打卡：{progress.wake||"—"}</div></div><button className="btn" onClick={()=>{const hm=toHM(new Date()); setProgress(p=>({...p,wake:hm})); notify('已记录起床',hm);}}>现在起床</button></div></div>
      <div className="p-4 bg-white rounded-xl shadow"><div className="flex justify-between"><div><div className="font-semibold">上床（≤ {config.targets.bed.by}）</div><div className="text-sm opacity-70">打卡：{progress.bed||"—"}</div></div><button className="btn" onClick={()=>{const hm=toHM(new Date()); setProgress(p=>({...p,bed:hm})); notify('已记录就寝',hm);}}>现在上床</button></div></div>
    </div>
    {['listening','readingVocab','english','strength','cardio'].map(k=>{
      const names={listening:'德语听力',readingVocab:'阅读+词汇',english:'英语',strength:'力量训练',cardio:'有氧'};
      const goals={listening:60,readingVocab:30,english:30,strength:40,cardio:30};
      const val=progress[k]||0; const goal=goals[k];
      return (<div key={k} className="p-4 bg-white rounded-xl shadow mb-3">
        <div className="flex justify-between"><div><div className="font-semibold">{names[k]}</div><div className="text-sm opacity-70">{val} / {goal} 分钟</div></div>
        <div className="flex items-center gap-2">{!(activeTimer&&activeTimer.key===k)?<button className="btn" onClick={()=>handleStartTimer(k)}>开始计时</button>:<button className="btn" onClick={handleStopTimer}>停止</button>}{[5,10,15,30].map(m=><button key={m} className="px-2 py-1 rounded bg-slate-100 text-xs" onClick={()=>add(k,m)}>+{m}m</button>)}</div></div>
        <div className="mt-2 w-full h-3 bg-slate-100 rounded-full overflow-hidden"><div className="h-3 bg-emerald-400" style={{width: Math.min(100,Math.round((val/goal)*100))+'%'}}></div></div>
      </div>);
    })}
    <div className="p-4 bg-white rounded-xl shadow mb-3">
      <div className="flex justify-between items-center"><div><div className="font-semibold">健康饮食</div><div className="text-sm opacity-70">少糖少油，多蔬果蛋白</div></div>
      <label className="inline-flex items-center gap-2"><input type="checkbox" checked={progress.eatHealthy} onChange={()=>setProgress(p=>({...p,eatHealthy:!p.eatHealthy}))}/><span>{progress.eatHealthy?'已达成':'未达成'}</span></label></div>
    </div>
    <div className="p-4 bg-white rounded-xl shadow">
      <div className="font-semibold mb-2">今日备注</div>
      <textarea className="w-full p-3 rounded-xl bg-slate-50 border" rows="3" placeholder="写点想法、反思或奖励自己的一句话" value={progress.notes} onChange={(e)=>setProgress(p=>({...p,notes:e.target.value}))}></textarea>
    </div>
  </div>);
}
const root=ReactDOM.createRoot(document.getElementById('root')); root.render(<HabitTracker/>);
if('serviceWorker' in navigator){ window.addEventListener('load',()=>{ navigator.serviceWorker.register('./sw.js'); });}
</script></body></html>